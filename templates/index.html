{% extends "layout.html" %}
{% block content %}

<style>
  body {
    background-color: #fffaf7;
  }

  h3, h4 {
    color: #6ca4a6;
    font-weight: 700;
  }

  /* Search Section */
  .search-container {
    max-width: 900px;
    margin: 2rem auto;
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    align-items: center;
  }

  #searchInput {
    flex: 1 1 60%;
    border: 2px solid#518d8f;
    border-radius: 8px;
    padding: 0.5rem 1rem;
  }

  #deptSelect {
    flex: 1 1 30%;
    border: 2px solid #518d8f;
    border-radius: 8px;
    padding: 0.5rem;
  }

  #searchBtn {
    flex: 1 1 8%;
    background-color:#518d8f;
    color: #fff;
    border: none;
    border-radius: 8px;
    padding: 0.5rem 0;
    font-weight: 600;
    transition: 0.3s;
  }

  #searchBtn:hover {
    background-color:#518d8f;
  }

  /* Carousel / New Books */
  .carousel-container {
    max-width: 1000px;
    margin: 2rem auto;
    overflow-x: auto;
    display: flex;
    gap: 1rem;
    padding-bottom: 1rem;
    scroll-behavior: smooth;
  }

  .book-card {
    flex: 0 0 220px;
    background-color: #fffdfc;
    border: 2px solid #518d8f;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(179, 0, 0, 0.15);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    transition: transform 0.3s;
  }

  .book-card:hover {
    transform: scale(1.05);
  }

  .book-card img {
    height: 170px;
    object-fit: cover;
    width: 100%;
  }

  .book-card-body {
    padding: 1rem;
    display: flex;
    flex-direction: column;
    flex: 1;
  }

  .book-card h5 {
    color:#518d8f;
    font-weight: 600;
    margin-bottom: 0.3rem;
    font-size: 1.1rem;
  }

  .book-card p {
    font-size: 0.85rem;
    margin: 0.2rem 0;
  }

  .book-card .btn-view {
    margin-top: auto;
    background-color: transparent;
    border: 1px solid #518d8f;
    color:#518d8f;
    border-radius: 8px;
    padding: 0.4rem;
    font-size: 0.85rem;
    transition: 0.3s;
    text-align: center;
  }

  .book-card .btn-view:hover {
    background-color: #518d8f;
    color: #fff;
  }

  /* Search Results Grid */
  #searchResults {
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
    justify-content: center;
    margin-top: 2rem;
  }

  /* No books found */
  #searchResults p {
    text-align: center;
    color:  #073062;
    margin-top: 2rem;
    font-weight: 600;
  }
  /* Books Grid Layout */
.books-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);  /* exactly 4 per row */
  gap: 1.5rem;
  max-width: 1000px;
  margin: 2rem auto;
  padding: 1rem;
}

</style>

<!-- Search Section -->
<div class="search-container">
  <input id="searchInput" placeholder="Search by title, author or description...">
  <select id="deptSelect">
    <option value="">All Departments</option>
    {% for d in departments %}
    <option value="{{ d }}">{{ d }}</option>
    {% endfor %}
  </select>
  <button id="searchBtn">Search</button>
</div>

{% if not search_results %}
  <!-- Show Books section only on homepage -->
  <!-- Books Grid -->
<h4 id="newBooksTitle" style="text-align:center;">Books</h4>
<div class="books-grid">
  {% for b in new_books %}
  <div class="book-card">
    <img src="{{ b['image'] or url_for('static', filename='images/placeholder.svg') }}">
    <div class="book-card-body">
      <h5>{{ b['title'] }}</h5>
      <p>By {{ b['author'] }} ({{ b['year'] }})</p>
      <p class="text-muted">{{ b['department_name'] or b['department'] }} • {{ b['type'] }}</p>
      <a href="{{ url_for('book_detail', book_id=b['id']) }}" class="btn-view">View</a>
    </div>
  </div>
  {% endfor %}
</div>

{% endif %}

{% if search_results %}
  <!-- Show only Search Results when searching -->
  <h4 style="text-align:center;">Search Results</h4>
  <div class="books-grid" id="searchResultsContainer">
    {% for b in search_results %}
    <div class="book-card">
      <img src="{{ b['image'] or url_for('static', filename='images/placeholder.svg') }}">
      <div class="book-card-body">
        <h5>{{ b['title'] }}</h5>
        <p>By {{ b['author'] }} ({{ b['year'] }})</p>
        <p class="text-muted">{{ b['department_name'] or b['department'] }} • {{ b['type'] }}</p>
        <a href="{{ url_for('book_detail', book_id=b['id']) }}" class="btn-view">View</a>
      </div>
    </div>
    {% endfor %}
  </div>
{% elif search_results is defined %}
  <!-- If defined but empty -->
  <p style="text-align:center;color: #073062;font-weight:600;margin-top:2rem;">No books found for your search.</p>
{% endif %}

<script>
document.getElementById("searchBtn").addEventListener("click", () => {
  const query = document.getElementById("searchInput").value;
  const dept = document.getElementById("deptSelect").value;
  window.location.href = `/search?q=${encodeURIComponent(query)}&dept=${encodeURIComponent(dept)}`;
});
</script>






{% endblock %}
